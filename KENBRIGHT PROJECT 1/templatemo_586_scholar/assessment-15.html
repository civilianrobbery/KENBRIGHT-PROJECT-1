<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#ffffff">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css2?family=Gill+Sans+Nova:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <title>Module 15 Assessment | Kenbright IFRS 17 Training</title>
    
    <!-- CSS Files -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-scholar.css">
    <link rel="stylesheet" href="assets/css/modules.css">
    <style>
        /* Apply Gill Sans font to entire page with 20px font size */
        body {
            font-family: 'Gill Sans Nova', 'Gill Sans', sans-serif;
            font-size: 20px;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Gill Sans Nova', 'Gill Sans', sans-serif;
            font-weight: 600;
        }
        
        .nav li a {
            font-family: 'Gill Sans Nova', 'Gill Sans', sans-serif;
            font-size: 20px;
        }
        
        .btn, .main-button a {
            font-family: 'Gill Sans Nova', 'Gill Sans', sans-serif;
            font-size: 20px;
        }

        /* Simplified header styling */
        .header-area {
            padding: 0 20px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .main-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px 0;
        }

        /* Ensure navigation items are properly spaced */
        .main-nav .nav {
            display: flex;
            gap: 20px;
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .main-nav .nav li a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s;
            font-family: 'Gill Sans Nova', 'Gill Sans', sans-serif;
            font-size: 20px;
        }

        .main-nav .nav li a:hover {
            color: #3B82F6;
        }

        /* Search input styling */
        .search-input {
            flex: 1;
            max-width: 400px;
            margin: 0 20px;
            position: relative;
        }

        .search-input input {
            width: 100%;
            padding: 12px 20px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-family: 'Gill Sans Nova', 'Gill Sans', sans-serif;
            font-size: 20px;
        }

        .search-input i {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
            font-size: 20px;
        }

        /* Logo Styles */
        .logo-image {
            height: 130px;
            width: auto;
            max-width: 500px;
        }

        .page-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }
        
        .page-loader.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .assessment-container {
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 35px;
            margin: 30px 0;
            font-family: 'Gill Sans Nova', 'Gill Sans', sans-serif;
            font-size: 20px;
        }
        
        .question-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
            font-family: 'Gill Sans Nova', 'Gill Sans', sans-serif;
            font-size: 20px;
        }
        
        .question-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }
        
        .question-number {
            background: #667eea;
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 20px;
            font-family: 'Gill Sans Nova', 'Gill Sans', sans-serif;
            font-size: 22px;
        }
        
        .option-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Gill Sans Nova', 'Gill Sans', sans-serif;
            font-size: 20px;
        }
        
        .option-item:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .option-item.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        
        .option-item.correct {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }
        
        .option-item.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
        
        .quiz-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 35px;
            font-family: 'Gill Sans Nova', 'Gill Sans', sans-serif;
            font-size: 20px;
        }
        
        .results-container {
            display: none;
            background: #fff;
            border-radius: 15px;
            padding: 35px;
            margin-top: 35px;
            border: 2px solid #e9ecef;
            font-family: 'Gill Sans Nova', 'Gill Sans', sans-serif;
            font-size: 20px;
        }
        
        .score-display {
            font-size: 4rem;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin: 25px 0;
            font-family: 'Gill Sans Nova', 'Gill Sans', sans-serif;
        }
        
        .progress-summary {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            font-family: 'Gill Sans Nova', 'Gill Sans', sans-serif;
            font-size: 20px;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 35px;
        }

        /* Final Assessment Specific Styles */
        .final-assessment-badge {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #7B5800;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 18px;
            display: inline-block;
            margin-bottom: 15px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-nav {
                flex-direction: column;
                gap: 15px;
            }
            
            .search-input {
                max-width: 100%;
                margin: 10px 0;
            }
            
            .main-nav .nav {
                gap: 15px;
            }
            
            .logo-image {
                height: 35px;
                max-width: 150px;
            }
            
            body {
                font-size: 18px;
            }
            
            .question-card, .option-item, .assessment-container, .quiz-header {
                font-size: 18px;
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .logo-image {
                height: 30px;
                max-width: 130px;
            }
            
            body {
                font-size: 16px;
            }
            
            .question-card, .option-item, .assessment-container, .quiz-header {
                font-size: 16px;
                padding: 15px;
            }
        }
    </style>
</head>

<body>

  <!-- Page Loader -->
  <div class="page-loader" id="pageLoader">
      <div class="loader-content">
          <div class="kenbright-loader">Kenbright</div>
          <div class="loader-spinner"></div>
          <div class="loader-text">Loading Final Assessment...</div>
      </div>
  </div>

  <!-- Header Area -->
  <header class="header-area header-sticky">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav class="main-nav">
                    <a href="index.html" class="logo">
                        <img src="assets/images/kenbright-logo.png" alt="Kenbright" class="logo-image">
                    </a>
                    <ul class="nav">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="modules.html">Training Modules</a></li>
                        <li><a href="assessments.html" class="active">Test Assessments</a></li>
                        <li><a href="progress.html">My Progress</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
  </header>

  <!-- Page Banner -->
  <div class="main-banner" id="top">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="header-text">
            <h2>Module 15 Assessment</h2>
            <p>Insurance Finance Income or Expenses & Foreign Currency Considerations</p>
            <div class="final-assessment-badge">
                <i class="fa fa-trophy"></i> Final Assessment
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Assessment Container -->
  <section class="section">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          
          <div class="quiz-header">
            <h3><i class="fa fa-graduation-cap"></i> Module 15 Final Assessment</h3>
            <p>Test your comprehensive understanding of IFRS 17 Implementation</p>
            <div class="progress" style="height: 10px; background: rgba(255,255,255,0.3);">
              <div class="progress-bar" id="quizProgress" style="width: 0%"></div>
            </div>
            <small id="progressText" style="font-size: 18px;">Question 1 of 15</small>
          </div>

          <div class="assessment-container">
            <div id="questionsContainer">
              <!-- Questions will be loaded here by JavaScript -->
            </div>
            
            <div class="navigation-buttons">
              <button class="main-button outline" id="prevQuestion" style="display: none; font-size: 20px;">
                <i class="fa fa-arrow-left"></i> Previous
              </button>
              <button class="main-button" id="submitQuiz" style="display: none; font-size: 20px;">
                <i class="fa fa-check-circle"></i> Submit Final Assessment
              </button>
              <button class="main-button" id="nextQuestion" style="display: none; font-size: 20px;">
                Next <i class="fa fa-arrow-right"></i>
              </button>
            </div>
          </div>

          <div class="results-container" id="resultsContainer">
            <h3 class="text-center"><i class="fa fa-graduation-cap"></i> Final Assessment Results</h3>
            <div class="score-display" id="finalScore">0/15</div>
            
            <div class="progress-summary">
              <div class="progress" style="height: 25px;">
                <div class="progress-bar" id="scoreProgress" role="progressbar" style="width: 0%"></div>
              </div>
              <div class="progress-text text-center mt-3">
                <span id="scorePercentage">0%</span> - <span id="performanceText">Beginner Level</span>
              </div>
            </div>

            <div id="questionsReview">
              <!-- Questions review will be loaded here -->
            </div>

            <div class="text-center mt-4">
              <button class="main-button outline" onclick="window.location.href='module-15.html'" style="font-size: 20px;">
                <i class="fa fa-book"></i> Review Module 15
              </button>
              <button class="main-button" id="completionCertificateBtn" onclick="window.location.href='progress.html'" style="font-size: 20px; background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); border: none;">
                <i class="fa fa-certificate"></i> View Certificate & Progress
              </button>
            </div>
          </div>

        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="col-lg-12">
        <p>Copyright Â© <span id="currentYear">2025</span> Kenbright IFRS 17 Training Platform. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
  
  <script>
    // Module 15 Questions Data with UPDATED CORRECT answers
    const module15Questions = [
      {
        question: "According to IFRS 17, what are the two main components of Insurance Finance Income or Expenses (IFIE)?",
        options: [
          "Time value of money (discounting) and changes in financial assumptions",
          "Premium collection and claims payment",
          "Investment performance and operational efficiency",
          "Acquisition costs and contract renewals"
        ],
        correctAnswer: 0, // 1st choice
        explanation: "IFIE consists of time value of money (discounting) and changes in financial assumptions."
      },
      {
        question: "For non-participating contracts, if an entity chooses to present all IFIE in Profit or Loss (Option 1), what is the impact on Other Comprehensive Income (OCI)?",
        options: [
          "The impact on OCI is neutral, as no IFIE component is recognized there",
          "OCI will show the portion of IFIE related to changes in discount rates",
          "OCI will be volatile due to market fluctuations",
          "OCI is used to record the systematic allocation of expected finance income"
        ],
        correctAnswer: 1, // 2nd choice
        explanation: "With Option 1, no IFIE component goes to OCI, making the OCI impact neutral."
      },
      {
        question: "Under IAS 21, how are insurance contracts classified for the purpose of foreign currency translation?",
        options: [
          "Monetary items",
          "Non-monetary items",
          "Equity instruments",
          "Derivatives"
        ],
        correctAnswer: 2, // 3rd choice
        explanation: "Insurance contracts are classified as monetary items for foreign currency translation under IAS 21."
      },
      {
        question: "Which of the following best describes the 'time value of money' component of IFIE?",
        options: [
          "The accretion of interest on discounted future cash flows",
          "The payment of claims to policyholders",
          "Changes in the risk adjustment for non-financial risk",
          "The amortization of acquisition costs"
        ],
        correctAnswer: 0, // 1st choice
        explanation: "The time value component represents interest accretion on discounted cash flows."
      },
      {
        question: "What is a primary reason an entity might choose to disaggregate IFIE between P&L and OCI for non-participating contracts?",
        options: [
          "To mitigate volatility in the P&L arising from changes in market discount rates",
          "To increase reported profit margins",
          "To simplify accounting for non-financial risks",
          "Because it is a mandatory requirement for all contracts"
        ],
        correctAnswer: 2, // 3rd choice
        explanation: "Disaggregation helps mitigate P&L volatility from market rate changes."
      },
      {
        question: "When a group of insurance contracts with IFIE previously recorded in OCI is derecognized, how should the accumulated OCI balance be treated if the entity applied Option 2 (split recognition)?",
        options: [
          "It is reclassified to P&L",
          "It is reversed in the next period's P&L",
          "It is permanently retained in equity",
          "It is transferred to a separate reserve account"
        ],
        correctAnswer: 0, // 1st choice
        explanation: "Accumulated OCI balance is reclassified to P&L upon derecognition."
      },
      {
        question: "For contracts with direct participation features, if changes in financial assumptions are excluded from IFIE and IFRS 17 rules prevent an adjustment to the CSM, where are these changes recognized?",
        options: [
          "As insurance service expenses",
          "As part of investment income",
          "In a separate reserve account",
          "Directly in equity"
        ],
        correctAnswer: 2, // 3rd choice
        explanation: "These changes are recognized as insurance service expenses."
      },
      {
        question: "How does a change in market interest rates directly affect the calculation of Insurance Finance Income or Expenses?",
        options: [
          "By changing the present value of future cash flows used to measure the insurance contract liability",
          "By modifying the amount of service revenue",
          "By triggering an immediate adjustment to the CSM",
          "By causing immediate premium refunds to policyholders"
        ],
        correctAnswer: 3, // 4th choice
        explanation: "Market rate changes affect the present value of future cash flows used in liability measurement."
      },
      {
        question: "If an entity's underlying items are measured at fair value through OCI, how should it typically present the related IFIE for participating contracts under the matching option?",
        options: [
          "Present IFIE in OCI to match the measurement of the underlying items",
          "Present IFIE fully in P&L",
          "Present IFIE fully in equity",
          "Do not recognize IFIE"
        ],
        correctAnswer: 3, // 4th choice
        explanation: "IFIE is presented in OCI to match the measurement of underlying items."
      },
      {
        question: "Which contract type is most directly affected by the accounting policy choice in IFRS 17 paragraph 88 regarding the disaggregation of IFIE?",
        options: [
          "Non-participating insurance contracts",
          "Investment contracts without Direct Participation Features",
          "Service contracts",
          "All contract types equally"
        ],
        correctAnswer: 1, // 2nd choice
        explanation: "Non-participating contracts are most affected by the disaggregation choice in paragraph 88."
      },
      {
        question: "What is the specific accounting consequence when a group of contracts with OCI-disaggregated IFIE is derecognized?",
        options: [
          "P&L includes the cumulative amount of IFIE that was previously recognized in OCI",
          "P&L remains completely unaffected by the OCI balances",
          "P&L shows a reversal of all past finance expenses",
          "P&L shows a one-time spike in insurance service revenue"
        ],
        correctAnswer: 2, // 3rd choice
        explanation: "Cumulative OCI IFIE is reclassified to P&L upon derecognition."
      },
      {
        question: "Which of the following is NOT a valid strategic reason for choosing to disaggregate IFIE between P&L and OCI?",
        options: [
          "To eliminate the need for tracking and reporting changes in financial assumptions entirely",
          "To improve the comparability of financial statements over time by reducing P&L volatility",
          "To reflect the impact of short-term market changes in OCI instead of P&L",
          "To match the reporting of liability valuation with asset valuation"
        ],
        correctAnswer: 0, // 1st choice
        explanation: "Eliminating tracking of financial assumption changes is not a valid reason; they must still be tracked."
      },
      {
        question: "How would an entity's exposure to equity risk typically manifest within its Insurance Finance Income or Expenses?",
        options: [
          "Through its impact on discount rates, which in turn affect the present value of the insurance contract liabilities",
          "Through direct changes in policyholder behavior and lapse rates",
          "Through unexpected increases in operational and administrative costs",
          "Through fluctuations in foreign exchange rates on international operations"
        ],
        correctAnswer: 3, // 4th choice
        explanation: "Equity risk affects discount rates, which then affect liability present values."
      },
      {
        question: "Why is the disaggregation of IFIE between P&L and OCI particularly relevant for contracts with direct participation features under the 'matching' option?",
        options: [
          "To reflect fair value changes in liabilities that are linked to the performance of underlying assets",
          "To increase the total comprehensive income reported",
          "Because they are exempt from other IFRS 17 disclosure requirements",
          "To simplify the accounting for the risk adjustment"
        ],
        correctAnswer: 1, // 2nd choice
        explanation: "For participating contracts, disaggregation matches liability changes with underlying asset performance."
      },
      {
        question: "In the context of implementing IFRS 17, what is a critical consideration regarding the 'locked-in' discount rate used for the P&L portion under the disaggregation approach for non-participating contracts?",
        options: [
          "It represents the discount rate at contract inception, creating a systematic allocation to P&L and isolating the effect of subsequent market changes to OCI",
          "It must be reset to current market rates at the end of every reporting period",
          "It is only applicable to the acquisition cash flows",
          "It is calculated as an average of the yield curve for the entire portfolio"
        ],
        correctAnswer: 1, // 2nd choice
        explanation: "The locked-in rate is fixed at inception, creating systematic P&L allocation while isolating market changes to OCI."
      }
    ];

    // Quiz functionality
    let currentQuestion = 0;
    let userAnswers = new Array(module15Questions.length).fill(null);
    let quizSubmitted = false;

    document.addEventListener('DOMContentLoaded', function() {
        const pageLoader = document.getElementById('pageLoader');
        
        // Update copyright year automatically
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        
        setTimeout(() => {
            pageLoader.classList.add('hidden');
            setTimeout(() => {
                pageLoader.remove();
                initializeQuiz();
            }, 500);
        }, 1500);

        // Add event listeners to buttons
        document.getElementById('nextQuestion').addEventListener('click', nextQuestion);
        document.getElementById('prevQuestion').addEventListener('click', prevQuestion);
        document.getElementById('submitQuiz').addEventListener('click', submitQuiz);
    });

    function initializeQuiz() {
        displayQuestion(currentQuestion);
        updateNavigation();
        updateProgress();
    }

    function displayQuestion(questionIndex) {
        const questionsContainer = document.getElementById('questionsContainer');
        const question = module15Questions[questionIndex];
        
        let optionsHtml = '';
        question.options.forEach((option, index) => {
            const isSelected = userAnswers[questionIndex] === index;
            optionsHtml += `
                <div class="option-item ${isSelected ? 'selected' : ''}" onclick="selectOption(${index})">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="question${questionIndex}" 
                               id="option${index}" ${isSelected ? 'checked' : ''} style="transform: scale(1.3); margin-right: 15px;">
                        <label class="form-check-label" for="option${index}" style="font-size: 20px;">
                            ${option}
                        </label>
                    </div>
                </div>
            `;
        });

        questionsContainer.innerHTML = `
            <div class="question-card">
                <div class="d-flex align-items-start">
                    <div class="question-number">${questionIndex + 1}</div>
                    <div class="flex-grow-1">
                        <h5 style="font-size: 24px;">${question.question}</h5>
                        <div class="options-container mt-4">
                            ${optionsHtml}
                        </div>
                    </div>
                </div>
            </div>
        `;

        updateNavigation();
    }

    function updateNavigation() {
        const hasAnswer = userAnswers[currentQuestion] !== null;
        const isLastQuestion = currentQuestion === module15Questions.length - 1;
        const isFirstQuestion = currentQuestion === 0;

        // Show/hide previous button
        document.getElementById('prevQuestion').style.display = isFirstQuestion ? 'none' : 'inline-block';
        
        // Show/hide next and submit buttons
        if (isLastQuestion) {
            document.getElementById('nextQuestion').style.display = 'none';
            document.getElementById('submitQuiz').style.display = hasAnswer ? 'inline-block' : 'none';
        } else {
            document.getElementById('nextQuestion').style.display = hasAnswer ? 'inline-block' : 'none';
            document.getElementById('submitQuiz').style.display = 'none';
        }
    }

    function selectOption(optionIndex) {
        userAnswers[currentQuestion] = optionIndex;
        displayQuestion(currentQuestion);
        updateNavigation();
        updateProgress();
    }

    function nextQuestion() {
        if (currentQuestion < module15Questions.length - 1) {
            currentQuestion++;
            displayQuestion(currentQuestion);
            updateNavigation();
            updateProgress();
        }
    }

    function prevQuestion() {
        if (currentQuestion > 0) {
            currentQuestion--;
            displayQuestion(currentQuestion);
            updateNavigation();
            updateProgress();
        }
    }

    function updateProgress() {
        const progress = ((currentQuestion + 1) / module15Questions.length) * 100;
        document.getElementById('quizProgress').style.width = `${progress}%`;
        document.getElementById('progressText').textContent = `Question ${currentQuestion + 1} of ${module15Questions.length}`;
    }

    function submitQuiz() {
        quizSubmitted = true;
        calculateScore();
        showResults();
    }

    function calculateScore() {
        let score = 0;
        module15Questions.forEach((question, index) => {
            if (userAnswers[index] === question.correctAnswer) {
                score++;
            }
        });
        return score;
    }

    function showResults() {
        const score = calculateScore();
        const percentage = (score / module15Questions.length) * 100;
        
        document.getElementById('finalScore').textContent = `${score}/${module15Questions.length}`;
        document.getElementById('scoreProgress').style.width = `${percentage}%`;
        document.getElementById('scorePercentage').textContent = `${percentage.toFixed(1)}%`;
        
        let performanceText = '';
        let performanceClass = '';
        if (percentage >= 90) {
            performanceText = 'Excellent! IFRS 17 Master';
            performanceClass = 'text-success';
        } else if (percentage >= 80) {
            performanceText = 'Very Good - Advanced Understanding';
            performanceClass = 'text-primary';
        } else if (percentage >= 70) {
            performanceText = 'Good - Solid Understanding';
            performanceClass = 'text-info';
        } else if (percentage >= 60) {
            performanceText = 'Satisfactory - Basic Understanding';
            performanceClass = 'text-warning';
        } else {
            performanceText = 'Needs Improvement - Review Required';
            performanceClass = 'text-danger';
        }
        
        document.getElementById('performanceText').textContent = performanceText;
        document.getElementById('performanceText').className = performanceClass;
        
        // Show questions review
        let reviewHtml = '<h4 class="mt-4" style="font-size: 24px;">Question Review</h4>';
        module15Questions.forEach((question, index) => {
            const userAnswer = userAnswers[index];
            const isCorrect = userAnswer === question.correctAnswer;
            const userAnswerText = userAnswer !== null ? question.options[userAnswer] : 'Not answered';
            const correctAnswerText = question.options[question.correctAnswer];
            
            reviewHtml += `
                <div class="question-card ${isCorrect ? 'border-success' : 'border-danger'}">
                    <div class="d-flex align-items-start">
                        <div class="question-number ${isCorrect ? 'bg-success' : 'bg-danger'}">${index + 1}</div>
                        <div class="flex-grow-1">
                            <h5 style="font-size: 22px;">${question.question}</h5>
                            <div class="mt-3" style="font-size: 20px;">
                                <p><strong>Your answer:</strong> 
                                <span class="${isCorrect ? 'text-success' : 'text-danger'}">${userAnswerText}</span></p>
                                ${!isCorrect ? `<p><strong>Correct answer:</strong> 
                                <span class="text-success">${correctAnswerText}</span></p>` : ''}
                                <p><strong>Explanation:</strong> ${question.explanation}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
        
        document.getElementById('questionsReview').innerHTML = reviewHtml;
        document.getElementById('resultsContainer').style.display = 'block';
        
        // Save progress to localStorage
        saveProgress(score, module15Questions.length);
        
        // Mark training as complete
        markTrainingComplete(score, percentage);
    }

    function saveProgress(score, totalQuestions) {
        const progressData = {
            module: 15,
            score: score,
            totalQuestions: totalQuestions,
            percentage: (score / totalQuestions) * 100,
            completed: true,
            timestamp: new Date().toISOString(),
            finalAssessment: true
        };
        
        let allProgress = JSON.parse(localStorage.getItem('kenbright_assessment_progress') || '[]');
        allProgress = allProgress.filter(item => item.module !== 15);
        allProgress.push(progressData);
        localStorage.setItem('kenbright_assessment_progress', JSON.stringify(allProgress));
        
        updateModuleCompletion(15);
    }

    function updateModuleCompletion(moduleNumber) {
        let moduleProgress = JSON.parse(localStorage.getItem('kenbright_module_progress') || '{}');
        moduleProgress[`module_${moduleNumber}`] = {
            completed: true,
            completionDate: new Date().toISOString(),
            score: calculateScore(),
            finalModule: true
        };
        localStorage.setItem('kenbright_module_progress', JSON.stringify(moduleProgress));
    }

    function markTrainingComplete(finalScore, percentage) {
        const completionData = {
            completed: true,
            completionDate: new Date().toISOString(),
            finalScore: finalScore,
            finalPercentage: percentage,
            totalModules: 15,
            allModulesCompleted: true
        };
        
        localStorage.setItem('kenbright_training_completion', JSON.stringify(completionData));
        
        // Show congratulatory message for high scores
        if (percentage >= 70) {
            setTimeout(() => {
                alert(`Congratulations! You have completed all 15 modules of the Kenbright IFRS 17 Training Platform with a score of ${percentage.toFixed(1)}%.\n\nVisit the Progress page to view your completion status.`);
            }, 500);
        }
    }

    // Make functions global for onclick events
    window.selectOption = selectOption;
    window.nextQuestion = nextQuestion;
    window.prevQuestion = prevQuestion;
    window.submitQuiz = submitQuiz;
  </script>
</body>
</html>